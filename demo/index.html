<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>SandBoxer demo</title>
	<script type="text/javascript" src="../node_modules/acorn/dist/acorn.js"></script>
	<script type="text/javascript" src="../node_modules/esprima/esprima.js"></script>
	<script type="text/javascript" src="../dist/sandboxr.js"></script>
</head>
<body>
<textarea id="codeArea" cols="40" rows="8">
var result = "";
function $ERROR (msg) {
	result += msg;
}

result;
</textarea>
<button id="acornExec">Exec (Acorn)</button>
<button id="esprimaExec">Exec (Esprima)</button>
<fieldset><legend>Result</legend><pre id="result"></pre></fieldset>
<fieldset><legend>Tree</legend><pre id="tree"></pre></fieldset>

<script type="text/javascript">
	document.getElementById("acornExec").onclick = function () {
		executeAst(acorn.parse);
	};
	
	document.getElementById("esprimaExec").onclick = function () {
		executeAst(esprima.parse);
	};
	
	function executeAst (parser) {
		var code = document.getElementById("codeArea").value;
		var ast = parser(code);

		document.getElementById("tree").innerHTML = JSON.stringify(ast, null, 2);

		debugger;
		var runner = new SandBoxr(ast, { parser: parser });
		var value = runner.execute();

		document.getElementById("result").innerHTML = JSON.stringify(value && value.result && value.result.getValue().value);
	}
	
	debugger;
			var env = SandBoxr.createEnvironment();
			env.init({
				comparers: {
					"implicitEquals": function (env, a, b) {
						if (a.isPrimitive && b.isPrimitive) {
							return a.value === b.value;
						}
						
						if (a.isPrimitive || b.isPrimitive) {
							return false;
						}
						
						return a === b;
					}
				}
			});
			
			var ast = acorn.parse("0 == '0'");
			var sandbox = SandBoxr.create(ast);
			sandbox.execute(env);
</script>
</body>
</html>